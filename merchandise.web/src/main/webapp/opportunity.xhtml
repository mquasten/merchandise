<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
xmlns:h="http://java.sun.com/jsf/html"
xmlns:f="http://java.sun.com/jsf/core"
xmlns:p="http://primefaces.org/ui"
xmlns:in="http://java.sun.com/jsf/composite/input"
xmlns:co="http://java.sun.com/jsf/composite/condition"
xmlns:ri="http://java.sun.com/jsf/composite/ruleInstance"
xmlns:ui="http://java.sun.com/jsf/facelets">


<h:body>

  <ui:composition template="masterlayout.xhtml">
  <ui:define name="content">
      <h2 style="text-align: center"><h:outputText value="#{message.opportunity_headline}" /></h2>
     
	 
	  <h:form>
 
	 
	 <p:panelGrid columns="1" styleClass="positionCentered">
	
	  <p:panelGrid  columns="3" columnClasses="labelColumnStyle,inputColumnStyle,messageColumnStyle" >
		 
		  
		  
		  		<p:outputLabel id="nameLabel" for="name" value="#{message.opportunity_name}" />  
                <p:inputText id="name" label="name"  value="#{opportunity.name}" styleClass="gridInputField" >
             
                   <p:ajax   process="name"  upadate="name nameMessage"  />
                </p:inputText>  
                    	
                
              
                <p:message id="nameMessage" for="name" display="text" />
                     	
             
                
                <p:outputLabel  for="description" value="#{message.opportunity_description}" />  
                <p:inputTextarea  id="description" value="#{opportunity.description }" style="width:100%" >
						<f:validateBean />
						 <p:ajax  process="description"   update ="description descriptionMessage"/>
				</p:inputTextarea >
		  		<p:message id="descriptionMessage"  for="description" display="text" />
		  		
		  		
		  		
		  		 <p:outputLabel  for="conditions" value="#{message.opportunity_products}" />  
		  		<h:panelGrid colums="1" > 
		  		<p:tree id="conditions"  var="node"   dynamic="true"   value="#{conditions.treeNode}"  selectionMode="single" selection="#{conditions.selected}"  style="width:100%;height:200px" >  
  
		  		  <p:treeNode>  
            			<h:outputText value="#{node}" >
            			  <f:converter converterId="conditionConverter" />
            			</h:outputText>
            
            			
            			
            		 
        			</p:treeNode>  
        			 <p:ajax listener="#{opportunityController.onConditionNodeSelect}" update="@form"  process="@this" event="select"  /> 
    			
    			
    			</p:tree>  
    			 <f:facet name="footer">
		  	          <p:button  value="#{message.opportunity_add_subject}"   outcome="/subjects.xhtml" icon="ui-icon-check"    >
		  	             	<f:param name="selectMode" value="true" />  
		  	          </p:button>
		  	            <p:commandButton  value="#{message.opportunity_delete_condition}"   action="#{opportunityController.deleteCondition}" icon="ui-icon-remove"  update="conditions"  process="@this"   rendered="#{(conditions.selected.data.class.simpleName == 'CommercialRelationImpl') || (conditions.selected.data.class.simpleName == 'ConditionImpl')}"   />
		  	          
			  		  <p:commandButton  value="#{message.opportunity_condition_add}"   action="#{opportunityController.clearCondition}" update="@form"  process="@this"  oncomplete="conditionDlg.show();"  icon="ui-icon-check"  rendered="#{conditions.selected.data.class.simpleName == 'CommercialRelationImpl'}" /> 	
			  		  
			  		  
			  		    <p:commandButton  value="#{message.opportunity_edit_rule}"   oncomplete="ruleInstanceDlg.show();"  update="conditions"  process="@this"   rendered="#{(conditions.selected.data.class.simpleName == 'CommercialRelationImpl') || (conditions.selected.data.class.simpleName == 'ConditionImpl')}"   />
			  		  
			  </f:facet>
    			
		  		</h:panelGrid>
		  		<p:message for="conditions" display="text" />
		  		
		  		<p:outputLabel  for="kind" value="#{message.opportunity_kind}" />  
                
                <p:selectOneMenu  id="kind" value="#{opportunity.kind}"  style="width:100%"  >  
                      				 <f:selectItem itemLabel="#{message.select_empty}" itemValue="" />
            							<f:selectItem itemLabel="#{message.opportunity_kind_product}" itemValue="ProductOrService" />  
            						<f:selectItem itemLabel="#{message.opportunity_kind_offer}" itemValue="Offer" />  
            						<f:selectItem itemLabel="#{message.opportunity_kind_tender}" itemValue="Tender" />  
           							<f:validateBean />
           						 <p:ajax   process="kind" update="kind kindMessage"  />	
		
        		</p:selectOneMenu >  
                
		  		<p:message id="kindMessage" for="kind" display="text" />
		  		
		  		<p:outputLabel  for="activities" value="#{message.opportunity_activities}" /> 
		  		
		  		
		  		<p:tree id="activities" style="width:100%;height:200px"    dynamic="true"   value="#{activityClassifications.treeNode}" var="node"    selectionMode="checkbox"    >  
  
        			<p:treeNode>  
            			<h:outputText value="#{node}" >
            					<f:converter converterId="classificationConverter" />
            			</h:outputText>  
            		 
        			</p:treeNode>  
        			  <p:ajax listener="#{opportunityController.onActivityNodeSelect}" update="@this" event="select"/>
        			 
    			</p:tree>  
  			<p:message for="activities" display="text" />
		  		
		  		
		  
		  	
		  	
		  	<p:outputLabel  for="products" value="#{message.opportunity_products}" /> 
		  		
		  		
		  		<p:tree id="products" style="width:100%;height:200px"    dynamic="true"   value="#{productClassifications.treeNode}" var="node"    selectionMode="checkbox"   >  
  
        			<p:treeNode>  
            			<h:outputText value="#{node}" >
            					<f:converter converterId="classificationConverter" />
            			</h:outputText>  
            		 
        			</p:treeNode>  
        			  <p:ajax listener="#{opportunityController.onProductNodeSelect}" update="@this" event="select"/>
        			 
    			</p:tree>  
  			
		  		
		  	<p:message for="products" display="text" />
		  	
		  	<p:outputLabel  for="keywordTable" value="#{message.opportunity_keyword}" /> 
		  	
		  	
		  
		  		<p:dataTable  id="keywordTable" var="keyWordVarVar" paginator="false"   value="#{opportunity.keyWords}"  selection="#{keyWordModel.selectedKeyWord}"  >  
			   	   <p:column selectionMode="single" style="width:2%" />  
                   <p:column headerText="#{message.opportunity_keyword_table_column_name}">#{keyWordVarVar}</p:column> 
                 
                   <p:ajax event="rowSelectRadio"  update="@form" process="@this"/> 
                   
			   <f:facet name="footer">
			        	<p:commandButton  value="#{message.opportunity_keyword_add}"  oncomplete="inputDlg.show();"   icon="ui-icon-check"    />  
		  	
		  	            <p:commandButton id="#{message.opportunity_save}" value="#{message.opportunity_keyword_delete}" action="#{opportunityController.deleteKeyWord}" process="@this,keywordTable"  update="@form"  rendered="#{not empty keyWordModel.selectedKeyWord}"  icon="ui-icon-close" />         
			  
			  			
			  </f:facet>
			   
			   </p:dataTable>
			   
			    
		  	
		   <p:message for="keywordTable" display="text" />   
		  	 
		 
		  	<f:facet name="footer">
		  			<p:button value="#{message.opportunity_cancel}"  outcome="/opportunities.xhtml"  style="float:left"  />
 					<p:commandButton id="saveOpportunity" value="#{message.opportunity_save}" action="#{opportunityController.save()}"
						icon="ui-icon ui-icon-disk"  style="float:right"   update="@form" process="@this, name,description,kind"   />
		  	</f:facet>
		  
            </p:panelGrid>
           


 </p:panelGrid>
 <in:input   title="#{message.opportunity_keyword_input_title}" submitText="#{message.opportunity_keyword_input_submit_text}" label="#{message.opportunity_keyword_input_label}"  saveAction="#{opportunityController.addKeyWord()}"/>
 <co:condition message="#{message}" addAction="#{opportunityController.addConditionValue()}"  deleteAction="#{opportunityController.deleteConditionValue()}"  saveAction="#{opportunityController.addCondition()}"/>
 <ri:ruleInstance  message="#{message}"  addAction="#{opportunityController.addRuleInstance()}"    />
 </h:form>
 </ui:define>
 </ui:composition>
 </h:body>
 
 
 
 
 </html>
 